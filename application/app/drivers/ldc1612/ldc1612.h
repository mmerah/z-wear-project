/*
 * Copyright (c) 2021
 *
 * SPDX-License-Identifier: Apache-2.0
 */

#ifndef LDC1612_H
#define LDC1612_H

// Channel Conversion Result and Error Status
#define LDC1612_REG_DATA0_MSB 0x00
#define LDC1612_REG_DATA0_LSB 0x01
#define LDC1612_REG_DATA1_MSB 0x02
#define LDC1612_REG_DATA1_LSB 0x03

// Reference Count Setting
#define LDC1612_REG_RCOUNT0 0X08
#define LDC1612_REG_RCOUNT1 0X09

// Offset Value
#define LDC1612_REG_OFFSET0 0X0C
#define LDC1612_REG_OFFSET1 0X0D

// Settling Reference Count
#define LDC1612_REG_SETTLECOUNT0 0X10
#define LDC1612_REG_SETTLECOUNT1 0X11

// Reference and Sensor Divider Setting
#define LDC1612_REG_CLOCK_DIVIDERS0 0X14
#define LDC1612_REG_CLOCK_DIVIDERS1 0X15

// Device Status Report
#define LDC1612_REG_STATUS 0X18

// Error Reporting Configuration
#define LDC1612_REG_ERROR_CONFIG 0X19

// Conversion Configuration
#define LDC1612_REG_CONFIG 0X1A

// Channel Multiplexing Configuration
#define LDC1612_REG_MUX_CONFIG 0X1B

// Reset Device
#define LDC1612_REG_RESET_DEV 0X1C

// Sensor Drive Configuration
#define LDC1612_REG_DRIVE_CURRENT0 0X1E
#define LDC1612_REG_DRIVE_CURRENT1 0X1F

// ID Registers
#define LDC1612_REG_MANUFACTURER_ID 0X7E
#define LDC1612_REG_DEVICE_ID 0X7F

// Configuration values
#define LDC1612_SAMPLING_TIME 50 //ms
#define LDC1612_ACQ_TIME 3       //ms

#define LDC1612_BUFFER_LEN 9

#define LDC1612_MAX_VALUE_16_BIT 65535
#define LDC1612_MAX_VALUE_28_BIT 268435455

// Macros for i2c write/read in init
#define ldc1612_write(x, y) ldc1612_i2c_write(drv_data->i2c, x, y)
#define ldc1612_read(x, y) ldc1612_i2c_read(drv_data->i2c, x, y)

// CONFIGURATIONS
#define LDC1612_FIN_DIV0_1 0x1000
#define LDC1612_FREF_DIV0_1 0x0001
#define LDC1612_FIN_DIV1_1 0x1000
#define LDC1612_FREF_DIV1_1 0x0001

#define LDC1612_SET_COUNT0_250 0x00FA
#define LDC1612_SET_COUNT1_250 0x00FA
#define LDC1612_SET_COUNT0_500 0x01F4

#define LDC1612_RCOUNT0_1200 0x04B0
#define LDC1612_RCOUNT1_1200 0x04B0
#define LDC1612_RCOUNT0_2400 0x0960

#define LDC1612_OFFSET0_4210 0x1072
#define LDC1612_OFFSET1_4210 0x1072

#define LDC1612_IDRIVE0_16 0x8000
#define LDC1612_INIT_IDRIVE0_0 0x0000
#define LDC1612_IDRIVE1_16 0x8000
#define LDC1612_INIT_IDRIVE1_0 0x0000

#define LDC1612_ERROR_CONFIG_NONE 0x0000

#define LDC1612_MUXCONFIG_AUTOSC_0 0x0000
#define LDC1612_MUXCONFIG_RR_SEQ_0 0x0000
#define LDC1612_MUXCONFIG_RESERVED 0x0208
#define LDC1612_MUXCONFIG_DEGLITCH_10MHz 0x0005

#define LDC1612_RESET_DEV_SET 0x0600 // ???

#define LDC1612_CONFIG_CONTIN_CONV_CH0 0x0000
#define LDC1612_CONFIG_SLEEPMODE_EN 0x2000
#define LDC1612_CONFIG_SLEEPMODE_DIS 0x0000
#define LDC1612_CONFIG_RP_OVERR_EN_1 0x1000
#define LDC1612_CONFIG_SENSOR_ACT_SEL_1 0x0800
#define LDC1612_CONFIG_AUTO_AMP_DIS_1 0x0400
#define LDC1612_CONFIG_REF_CLK_SRC_CLKIN 0x0200
#define LDC1612_CONFIG_REF_CLK_SRC_INT_OSC 0x0000
#define LDC1612_CONFIG_RESERVED_2 0x0000
#define LDC1612_CONFIG_INTB_DIS_0 0x0000
#define LDC1612_CONFIG_HIGH_CUR_DRV_0 0x0000
#define LDC1612_CONFIG_RESERVED 0x0001

#define LDC1612_MAX_VALUE_28BIT 268435455
#define LDC1612_MAX_VALUE_16BIT 65535

#define LDC1612_PUT_TO_SLEEP LDC1612_CONFIG_CONTIN_CONV_CH0 | LDC1612_CONFIG_SLEEPMODE_EN | LDC1612_CONFIG_RP_OVERR_EN_1 | LDC1612_CONFIG_SENSOR_ACT_SEL_1 | LDC1612_CONFIG_REF_CLK_SRC_INT_OSC | LDC1612_CONFIG_INTB_DIS_0 | LDC1612_CONFIG_HIGH_CUR_DRV_0 | LDC1612_CONFIG_RESERVED

#define LDC1612_WAKEUP LDC1612_CONFIG_CONTIN_CONV_CH0 | LDC1612_CONFIG_SLEEPMODE_DIS | LDC1612_CONFIG_RP_OVERR_EN_1 | LDC1612_CONFIG_SENSOR_ACT_SEL_1 | LDC1612_CONFIG_REF_CLK_SRC_INT_OSC | LDC1612_CONFIG_INTB_DIS_0 | LDC1612_CONFIG_HIGH_CUR_DRV_0 | LDC1612_CONFIG_RESERVED
static bool ldc1612_sleep_flag;
static uint32_t prev_signal;
bool device_on_body;

#endif // LDC1612_H